<!DOCTYPE html>
<html>
<head>
    <title>Friendly URLs - Configuration</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form class="pluginConfigurationForm">
                    <h2>Friendly URLs Configuration</h2>

                    <div class="checkboxContainer">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="enableMovieUrls" />
                            <span>Enable URLs for movies</span>
                        </label>
                    </div>

                    <div class="checkboxContainer">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="enableShowUrls" />
                            <span>Enable URLs for shows</span>
                        </label>
                    </div>

                    <div class="checkboxContainer">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="enablePersonUrls" />
                            <span>Enable URLs for people</span>
                        </label>
                    </div>

                    <div class="checkboxContainer">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="enableCollectionUrls" />
                            <span>Enable URLs for collections</span>
                        </label>
                    </div>

                    <div class="inputContainer">
                        <label for="baseUrl">Base URL:</label>
                        <input type="text" id="baseUrl" is="emby-input" />
                        <div class="fieldDescription">Base URL for friendly URLs (e.g., /web)</div>
                    </div>

                    <div class="checkboxContainer">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="autoGenerateUrls" />
                            <span>Automatically generate URLs for new content</span>
                        </label>
                    </div>

                    <br />
                    <button is="emby-button" type="submit" class="raised button-submit block">
                        <span>Save</span>
                    </button>
                </form>
            </div>
        </div>

        <script type="text/javascript">
            (function () {
                var pluginId = '12345678-1234-5678-9012-123456789012';

                function saveConfiguration() {
                    Dashboard.showLoadingMsg();

                    ApiClient.getPluginConfiguration(pluginId).then(function (config) {
                        config.EnableMovieUrls = document.getElementById('enableMovieUrls').checked;
                        config.EnableShowUrls = document.getElementById('enableShowUrls').checked;
                        config.EnablePersonUrls = document.getElementById('enablePersonUrls').checked;
                        config.EnableCollectionUrls = document.getElementById('enableCollectionUrls').checked;
                        config.BaseUrl = document.getElementById('baseUrl').value;
                        config.AutoGenerateUrls = document.getElementById('autoGenerateUrls').checked;

                        ApiClient.updatePluginConfiguration(pluginId, config).then(function () {
                            Dashboard.hideLoadingMsg();
                            require(['toast'], function (toast) {
                                toast('Configuration saved');
                            });
                        }).catch(function (error) {
                            Dashboard.hideLoadingMsg();
                            require(['toast'], function (toast) {
                                toast('Error saving configuration: ' + error);
                            });
                        });
                    }).catch(function (error) {
                        Dashboard.hideLoadingMsg();
                        require(['toast'], function (toast) {
                            toast('Error loading configuration: ' + error);
                        });
                    });
                }

                function loadConfiguration() {
                    Dashboard.showLoadingMsg();

                    ApiClient.getPluginConfiguration(pluginId).then(function (config) {
                        document.getElementById('enableMovieUrls').checked = config.EnableMovieUrls || false;
                        document.getElementById('enableShowUrls').checked = config.EnableShowUrls || false;
                        document.getElementById('enablePersonUrls').checked = config.EnablePersonUrls || false;
                        document.getElementById('enableCollectionUrls').checked = config.EnableCollectionUrls || false;
                        document.getElementById('baseUrl').value = config.BaseUrl || '/web';
                        document.getElementById('autoGenerateUrls').checked = config.AutoGenerateUrls || false;

                        Dashboard.hideLoadingMsg();
                    }).catch(function (error) {
                        Dashboard.hideLoadingMsg();
                        require(['toast'], function (toast) {
                            toast('Error loading configuration: ' + error);
                        });
                    });
                }

                // Event handlers
                document.querySelector('.pluginConfigurationForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    saveConfiguration();
                });

                document.querySelector('.pluginConfigurationPage').addEventListener('pageshow', function () {
                    loadConfiguration();
                });
            })();
        </script>
    </div>
</body>
</html>